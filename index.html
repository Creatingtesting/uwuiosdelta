<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luau Code Deobfuscator</title>
    <style>
        body {
            background: linear-gradient(135deg, #1e1e2f, #2a2a4e);
            color: #ffffff;
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: auto;
        }
        .container {
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            width: 700px;
            max-width: 90%;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        h1 {
            font-size: 2em;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #00ffff;
        }
        textarea {
            width: 100%;
            height: 150px;
            background: #2e2e4e;
            border: 1px solid #00ffff;
            border-radius: 10px;
            color: #ffffff;
            padding: 10px;
            font-family: 'Courier New', monospace;
            resize: none;
            box-sizing: border-box;
        }
        .buttons {
            margin: 20px 0;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        .toggles {
            margin: 10px 0;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 20px;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            border: none;
            border-radius: 5px;
            color: #ffffff;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 5px;
        }
        button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }
        label {
            margin: 5px;
            font-size: 0.9em;
        }
        #output {
            background: #1e1e2f;
            border: 1px solid #ff00ff;
            border-radius: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-x: auto;
            overflow-y: auto;
            text-align: left;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            box-sizing: border-box;
        }
        #output-type {
            font-size: 0.9em;
            color: #00ffff;
            margin-bottom: 10px;
        }
        .glow {
            animation: glow 1.5s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from {
                box-shadow: 0 0 10px #00ffff;
            }
            to {
                box-shadow: 0 0 20px #ff00ff;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="glow">Luau Code Deobfuscator</h1>
        <textarea id="inputCode" placeholder="Enter your Moonsec V3 or other obfuscated Luau code here..."></textarea>
        <div class="toggles">
            <label><input type="checkbox" id="antiTamper"> Has Anti Tamper</label>
            <label><input type="checkbox" id="maxProtection"> Has Maximum Protection</label>
            <label><input type="checkbox" id="24Protection"> Has 24/7 Protection</label>
            <label><input type="checkbox" id="over5kb"> Has Over 5KB Junk</label>
        </div>
        <div class="buttons">
            <button onclick="deobfuscate('base64')">Deobfuscate Base64</button>
            <button onclick="deobfuscate('xor')">Deobfuscate XOR</button>
            <button onclick="deobfuscate('rename')">Simplify Variables</button>
            <button onclick="deobfuscate('control')">Remove Control Flow</button>
            <button onclick="deobfuscate('moonsec')">Deobfuscate Moonsec V3</button>
            <button onclick="deobfuscate('max')">Deobfuscate Everything</button>
            <button onclick="showSupport()">Support</button>
            <button onclick="copyCode()">Copy Code</button>
        </div>
        <h2>Deobfuscated Code</h2>
        <div id="output-type">Select a deobfuscation method...</div>
        <div id="output">Deobfuscated code will appear here...</div>
    </div>

    <script>
        const defaultCode = `
local function b64decode(str)
    local b = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
    local t = {}
    for i = 1, #str do
        local c = string.sub(str, i, i)
        if c != '=' then
            local v = string.find(b, c) - 1
            table.insert(t, v)
        end
    end
    local r = {}
    for i = 1, #t, 4 do
        local v1, v2, v3, v4 = t[i], t[i+1], t[i+2], t[i+3]
        local a = bit32.rshift(v1 * 4 + bit32.rshift(v2, 4), 0)
        local b = bit32.rshift(bit32.band(v2, 15) * 16 + bit32.rshift(v3 || 0, 2), 0)
        local c = bit32.rshift(bit32.band(v3 || 0, 3) * 64 + (v4 || 0), 0)
        table.insert(r, string.char(a))
        if v3 then table.insert(r, string.char(b)) end
        if v4 then table.insert(r, string.char(c)) end
    end
    return table.concat(r)
end
local function xorDecode(str, key)
    local result = {}
    for i = 1, #str do
        local char = string.byte(str, i)
        table.insert(result, string.char(bit32.bxor(char, key)))
    end
    return table.concat(result)
end
local function checkTamper()
    if false then
        error("Script tampered!")
    end
end
checkTamper()
spawn(function()
    while true do
        wait(10)
    end
end)
local _xYzAbCdEfGhIj = math.random()
local _pQrStUvWxYzAb = math.random()
local _kLmNoPqRsTuVwXyZ = game.Players.LocalPlayer
if _aBcDeFgHiJkLm == math.random(1, 100) then
    local _nOpQrStUvWxY = math.sin(math.random())
    local _zAbCdEfGhIjKl = math.cos(math.random())
    local _wXyZaBcDeFgHi = math.tan(math.random())
else
    local _nOpQrStUvWxY = math.cos(math.random())
    local _zAbCdEfGhIjKl = math.sin(math.random())
    local _wXyZaBcDeFgHi = math.tan(math.random())
end
local function _mNoPqRsTuVwXyZaB(_bCdEfGhIjKlMnOpQ)
    print(b64decode(xorDecode("khoor/#", 42)) .. _bCdEfGhIjKlMnOpQ .. xorDecode("k", 42))
end
_mNoPqRsTuVwXyZaB(_kLmNoPqRsTuVwXyZ.Name)
for _iJkLmNoPqRsTu = 1, 5 do
    print(xorDecode("Flrjk;%", 42) .. _iJkLmNoPqRsTu)
end
`;

        function deobfuscate(type) {
            let code = document.getElementById('inputCode').value || defaultCode;
            let output = code;
            const antiTamper = document.getElementById('antiTamper').checked;
            const maxProtection = document.getElementById('maxProtection').checked;
            const protection247 = document.getElementById('24Protection').checked;
            const over5kb = document.getElementById('over5kb').checked;

            let outputType = '';

            // Remove comments
            output = output
                .replace(/--\[\[[\s\S]*?\]\]/g, '')
                .replace(/--[^\n]*/g, '');

            // Remove Anti Tamper code if toggle is on
            if (antiTamper) {
                output = output.replace(/local function checkTamper\(\)\s*if false then\s*error\("Script tampered!"\)\s*end\s*end\s*checkTamper\(\)/g, '');
            }

            // Remove 24/7 Protection code if toggle is on
            if (protection247) {
                output = output.replace(/spawn\(function\(\)\s*while true do\s*wait\(10\)\s*end\s*end\)/g, '');
            }

            // Remove 5KB junk code if toggle is on
            if (over5kb) {
                output = output.replace(/local _[a-zA-Z_]{9,}\s*=\s*(b64decode\("[^"]*"\)|math\.random\(\)|[0-9]+|nil)\s*\n/g, '');
            }

            // Remove control flow junk code
            if (type === 'control' || type === 'max') {
                output = output.replace(/if _[a-zA-Z_]+\s*==\s*math\.random\(1,\s*100\)\s*then\s*(local _[a-zA-Z_]+\s*=\s*math\.(sin|cos|tan)\(math\.random\(\)\)\s*){1,3}else\s*(local _[a-zA-Z_]+\s*=\s*math\.(sin|cos|tan)\(math\.random\(\)\)\s*){1,3}end\s*/g, '');
                outputType = type === 'control' ? 'Remove Control Flow' : outputType;
            }

            // Deobfuscate Base64 strings
            if (type === 'base64' || type === 'max') {
                if (maxProtection) {
                    output = output.replace(/b64decode\(b64decode\("([^"]*)"\)\)/g, (match, encoded) => {
                        try {
                            let decoded = atob(atob(encoded));
                            return `"${decoded.replace(/"/g, '\\"')}"`;
                        } catch (e) {
                            console.error('Base64 decoding failed:', e);
                            return match;
                        }
                    });
                } else {
                    output = output.replace(/b64decode\("([^"]*)"\)/g, (match, encoded) => {
                        try {
                            let decoded = atob(encoded);
                            return `"${decoded.replace(/"/g, '\\"')}"`;
                        } catch (e) {
                            console.error('Base64 decoding failed:', e);
                            return match;
                        }
                    });
                }
                output = output.replace(/local function b64decode\(str\)\s*local b = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\+\/'\s*[\s\S]*?return table\.concat\(r\)\s*end/, '');
                outputType = type === 'base64' ? 'Deobfuscate Base64' : outputType;
            }

            // Deobfuscate XOR strings
            if (type === 'xor' || type === 'max') {
                output = output.replace(/xorDecode\("([^"]*)",\s*42\)/g, (match, encoded) => {
                    let decrypted = '';
                    for (let i = 0; i < encoded.length; i++) {
                        decrypted += String.fromCharCode(encoded.charCodeAt(i) ^ 42);
                    }
                    return `"${decrypted.replace(/"/g, '\\"')}"`;
                });
                output = output.replace(/local function xorDecode\(str,\s*key\)\s*local result = {}\s*for i = 1, #str do\s*local char = string\.byte\(str,\s*i\)\s*table\.insert\(result,\s*string\.char\(bit32\.bxor\(char,\s*key\)\)\)\s*end\s*return table\.concat\(result\)\s*end/, '');
                outputType = type === 'xor' ? 'Deobfuscate XOR' : outputType;
            }

            // Deobfuscate Moonsec V3
            if (type === 'moonsec' || type === 'max') {
                // Remove Moonsec header
                output = output.replace(/This file was protected with MoonSec V3 by Federal#9999\n?/g, '');

                // Remove Moonsec VM wrapper and junk code
                output = output.replace(/local function \([a-zA-Z_]+\)\s*local [a-zA-Z_]+ = nil\s*[a-zA-Z_]+:gsub\('.+'\),\s*\(function\(a\)\s*[a-zA-Z_]+ = a;\s*end\)\s*return\s*\(function\([a-zA-Z_, ]+\)\s*local [a-zA-Z_ ]+;[\s\S]*?return [a-zA-Z_ ]+\s*end\)\s*end/g, '');

                // Handle Moonsec V3 string (single-line or loadstring)
                const mainScriptMatch = output.match(/loadstring\("([^"]+)"\)/);
                if (!mainScriptMatch && output.trim().match(/^[a-zA-Z0-9+\/_-]+$/)) {
                    // Single-line Moonsec string
                    try {
                        let decoded = decodeMoonsecString(output.trim());
                        if (isValidLua(decoded)) {
                            output = decoded;
                        } else {
                            output = `-- Warning: Decoded Moonsec V3 string may not be valid Lua code\n${decoded}`;
                        }
                    } catch (e) {
                        console.error('Moonsec V3 decoding failed:', e);
                        output = `-- Failed to decode Moonsec V3 string: ${e.message}\n${output}`;
                    }
                } else if (mainScriptMatch) {
                    // Loadstring-based Moonsec code
                    try {
                        let decoded = decodeMoonsecString(mainScriptMatch[1]);
                        if (isValidLua(decoded)) {
                            output = output.replace(/loadstring\("([^"]+)"\)/g, decoded);
                        } else {
                            output = `-- Warning: Decoded Moonsec V3 loadstring may not be valid Lua code\n${decoded}`;
                        }
                        output = output.replace(/loadstring\([^)]+\)\(\)/g, '');
                    } catch (e) {
                        console.error('Moonsec V3 loadstring decoding failed:', e);
                        output = `-- Failed to decode Moonsec V3 loadstring: ${e.message}\n${output}`;
                    }
                }

                // Remove junk variable assignments
                output = output.replace(/local _[a-zA-Z_]{9,}\s*=\s*(math\.(sin|cos|tan|random)\(\)|[0-9]+|nil)\s*\n/g, '');
                outputType = type === 'moonsec' ? 'Deobfuscate Moonsec V3' : outputType;
            }

            // Simplify variable names
            if (type === 'rename' || type === 'max') {
                let varCounter = 1;
                let funcCounter = 1;
                const varMap = {};

                // Collect all random variable names
                const varNames = new Set();
                output.replace(/_[a-zA-Z_]{9,}/g, (match) => {
                    varNames.add(match);
                });

                // Assign simple names
                varNames.forEach((varName) => {
                    if (!varMap[varName]) {
                        varMap[varName] = output.includes(`function ${varName}`) ? `func${funcCounter++}` : `var${varCounter++}`;
                    }
                });

                // Replace variable names
                output = output.replace(/_[a-zA-Z_]{9,}/g, (match) => varMap[match] || match);
                outputType = type === 'rename' ? 'Simplify Variables' : outputType;
            }

            if (type === 'max') {
                outputType = 'Deobfuscate Everything';
            }

            // Clean up empty lines and extra whitespace
            output = output.replace(/\n\s*\n/g, '\n').trim();

            document.getElementById('output-type').textContent = `Deobfuscation Type: ${outputType || 'Unknown'}`;
            document.getElementById('output').textContent = output || 'Error: No output generated';
        }

        function showSupport() {
            document.getElementById('output-type').textContent = 'Support';
            document.getElementById('output').textContent = 'Coming soon';
        }

        function decodeMoonsecString(encoded) {
            // Try multiple decoding strategies for Moonsec V3
            let decoded = '';
            const keys = [42, 1337, 69]; // Common Moonsec XOR keys
            let bestResult = '';
            let bestScore = 0;

            // Try XOR decoding with different keys
            for (let key of keys) {
                let result = '';
                for (let i = 0; i < encoded.length; i++) {
                    result += String.fromCharCode(encoded.charCodeAt(i) ^ key);
                }
                if (isValidLua(result)) {
                    return result; // Return immediately if valid Lua
                }
                let score = scoreLuaLikelihood(result);
                if (score > bestScore) {
                    bestScore = score;
                    bestResult = result;
                }
            }

            // Try substitution cipher (basic, based on common Lua characters)
            const validLuaChars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_ ;=(),.+-*/{}[]"\n';
            let substResult = '';
            for (let i = 0; i < encoded.length; i++) {
                let char = encoded[i];
                if (validLuaChars.includes(char)) {
                    substResult += char;
                } else {
                    // Map non-alphanumeric to valid Lua characters (cyclic mapping)
                    let index = (char.charCodeAt(0) % validLuaChars.length);
                    substResult += validLuaChars[index];
                }
            }
            if (isValidLua(substResult)) {
                return substResult;
            }
            if (scoreLuaLikelihood(substResult) > bestScore) {
                bestResult = substResult;
            }

            return bestResult || encoded; // Return best attempt or original if all fail
        }

        function isValidLua(code) {
            // Basic check for Lua validity (contains common Lua keywords and syntax)
            const luaKeywords = ['local', 'function', 'end', 'if', 'then', 'else', 'for', 'while', 'do', 'return'];
            return luaKeywords.some(keyword => code.includes(keyword)) && code.match(/[a-zA-Z_][a-zA-Z0-9_]*\s*=/);
        }

        function scoreLuaLikelihood(code) {
            // Score based on presence of Lua-like patterns
            let score = 0;
            const luaPatterns = [
                /local\s+[a-zA-Z_][a-zA-Z0-9_]*\s*=/g,
                /function\s+[a-zA-Z_][a-zA-Z0-9_]*\s*\(/g,
                /end\s*;/g,
                /if\s+.*\s+then/g,
                /print\s*\(/g
            ];
            luaPatterns.forEach(pattern => {
                if (code.match(pattern)) score += 10;
            });
            return score;
        }

        function copyCode() {
            const output = document.getElementById('output').textContent;
            if (output && output !== 'Deobfuscated code will appear here...' && output !== 'Coming soon') {
                navigator.clipboard.writeText(output).then(() => {
                    alert('Code copied to clipboard!');
                }).catch(err => {
                    alert('Failed to copy: ' + err);
                });
            } else {
                alert('No code to copy!');
            }
        }

        function atob(str) {
            try {
                return decodeURIComponent(escape(window.atob(str)));
            } catch (e) {
                console.error('Base64 decoding failed:', e);
                return str;
            }
        }
    </script>
</body>
</html>
