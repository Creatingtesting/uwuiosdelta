<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Luau Deobfuscator</title>
  <style>
    body { font-family: monospace; background:#111; color:#0f0; padding:20px; }
    h1 { color:#6f6; }
    textarea {
      width:100%; height:200px; margin-top:10px;
      background:#222; color:#0f0; border:none; padding:10px;
    }
    button {
      margin-top:10px; padding:10px 20px;
      background:#333; color:#0f0; border:none; cursor:pointer;
    }
    button:hover { background:#444; }
  </style>
</head>
<body>
  <h1>Luau Deobfuscator</h1>
  <textarea id="input" placeholder="Paste obfuscated Luau code here..."></textarea>
  <br>
  <button onclick="deobfuscate()">Deobfuscate</button>
  <h2>Result:</h2>
  <textarea id="output" readonly></textarea>

  <script>
    // Decode \ddd ASCII escapes
    function decodeAscii(str) {
      return str.replace(/\\(\d{1,3})/g, (_, num) =>
        String.fromCharCode(parseInt(num, 10))
      );
    }

    // Decode base64 safely
    function decodeBase64(str) {
      try { return atob(str); } catch { return str; }
    }

    // Simple XOR decoder (default key = 123)
    function xorDecode(str, key=123) {
      return str.split('')
        .map(c => String.fromCharCode(c.charCodeAt(0) ^ key))
        .join('');
    }

    function deobfuscate() {
      let code = document.getElementById("input").value;

      // Step 1: ASCII \ddd
      code = decodeAscii(code);

      // Step 2: Base64 patterns
      code = code.replace(/["']([A-Za-z0-9+/=]{12,})["']/g, (m, g) => {
        let decoded = decodeBase64(g);
        return decoded.includes("function") || decoded.includes("{") ? decoded : m;
      });

      // Step 3: Remove obvious junk wrappers like :gsub(...)
      code = code.replace(/:gsub\(.+?\);?/g, "");

      // Step 4: Optional XOR try (common keys)
      for (let k = 1; k < 5; k++) {
        if (/\\x[0-9A-Fa-f]{2}/.test(code)) {
          code = xorDecode(code, k);
        }
      }

      document.getElementById("output").value = code;
    }
  </script>
</body>
</html>
