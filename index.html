<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Luau Deobfuscator</title>
  <style>
    body { font-family: monospace; background: #111; color: #eee; padding: 20px; }
    textarea { width: 100%; height: 200px; background: #222; color: #0f0; border: none; padding: 10px; }
    button { margin: 10px 0; padding: 10px 20px; background: #333; color: #fff; border: none; cursor: pointer; }
    button:hover { background: #444; }
    pre { background: #222; padding: 10px; white-space: pre-wrap; word-wrap: break-word; }
  </style>
</head>
<body>
  <h1>Luau Deobfuscator</h1>
  <textarea id="input" placeholder="Paste obfuscated Luau code here..."></textarea>
  <br>
  <button onclick="deobfuscate()">Deobfuscate</button>
  <h2>Result:</h2>
  <pre id="output"></pre>

  <script>
    function decodeAscii(str) {
      return str.replace(/\\(\d{1,3})/g, (_, num) =>
        String.fromCharCode(parseInt(num, 10))
      );
    }

    function decodeBase64(str) {
      try { return atob(str); } catch { return str; }
    }

    function deobfuscate() {
      let code = document.getElementById("input").value;

      // Step 1: Convert ASCII escapes like \117\115 â†’ "us"
      code = decodeAscii(code);

      // Step 2: Try to decode base64 strings
      code = code.replace(/["']([A-Za-z0-9+/=]{8,})["']/g, (m, g) => {
        let d = decodeBase64(g);
        return d.includes("{") || d.includes("function") ? d : m;
      });

      // Step 3: Clean redundant obfuscation wrappers like :gsub('.+', function...)
      code = code.replace(/:gsub\(.+?\);/g, "");

      document.getElementById("output").textContent = code;
    }
  </script>
</body>
</html>
