<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Luau Deobfuscator</title>
  <style>
    body { font-family: monospace; background:#111; color:#0f0; padding:20px; }
    textarea {
      width:100%; height:200px; margin-top:10px;
      background:#222; color:#0f0; border:none; padding:10px;
    }
    button {
      margin-top:10px; padding:10px 20px;
      background:#333; color:#0f0; border:none; cursor:pointer;
    }
    button:hover { background:#444; }
  </style>
</head>
<body>
  <h1>Luau Multi-Pass Deobfuscator</h1>
  <textarea id="input" placeholder="Paste obfuscated Luau code here..."></textarea>
  <br>
  <button onclick="deobfuscate()">Deobfuscate</button>
  <h2>Result:</h2>
  <textarea id="output" readonly></textarea>

  <script>
    function decodeAscii(str) {
      return str.replace(/\\(\d{1,3})/g, (_, num) =>
        String.fromCharCode(parseInt(num, 10))
      );
    }

    function decodeHex(str) {
      return str.replace(/\\x([0-9A-Fa-f]{2})/g, (_, hex) =>
        String.fromCharCode(parseInt(hex, 16))
      );
    }

    function decodeBase64(str) {
      try { return atob(str); } catch { return str; }
    }

    function xorDecode(str, key) {
      return str.split('')
        .map(c => String.fromCharCode(c.charCodeAt(0) ^ key))
        .join('');
    }

    function looksLikeLuau(s) {
      return /(function|local|return|end|if|then)/.test(s);
    }

    function deobfuscate() {
      let code = document.getElementById("input").value;
      let prev = "";

      // Keep decoding until stable
      for (let pass = 0; pass < 10; pass++) {
        prev = code;

        // Try ASCII + HEX
        code = decodeAscii(code);
        code = decodeHex(code);

        // Try base64 segments
        code = code.replace(/["']([A-Za-z0-9+/=]{12,})["']/g, (m, g) => {
          let d = decodeBase64(g);
          return looksLikeLuau(d) ? d : m;
        });

        // Try XOR with small keys
        for (let k = 1; k < 256; k++) {
          let trial = xorDecode(code, k);
          if (looksLikeLuau(trial)) {
            code = trial;
            break;
          }
        }

        // Remove junk :gsub() wrappers
        code = code.replace(/:gsub\(.+?\);?/g, "");

        // Stop if no change
        if (code === prev) break;
      }

      document.getElementById("output").value = code;
    }
  </script>
</body>
</html>
