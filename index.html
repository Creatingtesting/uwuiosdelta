<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luau Code Obfuscator</title>
    <style>
        body {
            background: linear-gradient(135deg, #1e1e2f, #2a2a4e);
            color: #ffffff;
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: auto;
        }
        .container {
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            width: 700px;
            max-width: 90%;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        h1 {
            font-size: 2em;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #00ffff;
        }
        textarea {
            width: 100%;
            height: 150px;
            background: #2e2e4e;
            border: 1px solid #00ffff;
            border-radius: 10px;
            color: #ffffff;
            padding: 10px;
            font-family: 'Courier New', monospace;
            resize: none;
            box-sizing: border-box;
        }
        .buttons {
            margin: 20px 0;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        .toggles {
            margin: 10px 0;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 20px;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            border: none;
            border-radius: 5px;
            color: #ffffff;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 5px;
        }
        button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }
        label {
            margin: 5px;
            font-size: 0.9em;
        }
        #output {
            background: #1e1e2f;
            border: 1px solid #ff00ff;
            border-radius: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-x: auto;
            overflow-y: auto;
            text-align: left;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            box-sizing: border-box;
        }
        #output-type {
            font-size: 0.9em;
            color: #00ffff;
            margin-bottom: 10px;
        }
        .glow {
            animation: glow 1.5s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from {
                box-shadow: 0 0 10px #00ffff;
            }
            to {
                box-shadow: 0 0 20px #ff00ff;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="glow">Luau Code Obfuscator</h1>
        <textarea id="inputCode" placeholder="Enter your Luau code here..."></textarea>
        <div class="toggles">
            <label><input type="checkbox" id="antiTamper"> Anti Tamper</label>
            <label><input type="checkbox" id="maxProtection"> Maximum Protection</label>
            <label><input type="checkbox" id="24Protection"> 24/7 Protection</label>
            <label><input type="checkbox" id="over5kb"> Over 5KB Size</label>
            <label><input type="checkbox" id="numObf"> Number Obfuscation</label>
            <label><input type="checkbox" id="strSplit"> String Splitting</label>
            <label><input type="checkbox" id="hideSource"> Hide Source</label>
            <label><input type="checkbox" id="minify"> Minify Code</label>
            <label><input type="checkbox" id="deadCode"> Dead Code Insertion</label>
        </div>
        <div class="buttons">
            <button onclick="obfuscate('base64')">Base64 Strings</button>
            <button onclick="obfuscate('xor')">XOR Strings</button>
            <button onclick="obfuscate('rename')">Variable Renaming</button>
            <button onclick="obfuscate('control')">Control Flow</button>
            <button onclick="obfuscate('max')">Obfuscate Using Everything</button>
            <button onclick="copyCode()">Copy Code</button>
        </div>
        <h2>Obfuscated Code</h2>
        <div id="output-type">Select an obfuscation method...</div>
        <div id="output">Obfuscated code will appear here...</div>
    </div>

    <script>
        const defaultCode = `local player = game.Players.LocalPlayer
local function greet(name)
    print("Hello, " .. name .. "!")
end
greet(player.Name)
for i = 1, 5 do
    print("Count: " .. i)
end`;

        const base64DecodeFn = `
local function b64decode(str, tbl)
    local r = {}
    local t = {}
    for i = 1, #str do
        local c = string.sub(str, i, i)
        if c ~= '=' then
            local v = string.find(tbl, c, 1, true)
            if v then
                table.insert(t, v - 1)
            else
                return ""
            end
        end
    end
    for i = 1, #t, 4 do
        local v1 = t[i] or 0
        local v2 = t[i+1] or 0
        local v3 = t[i+2] or 0
        local v4 = t[i+3] or 0
        local a = bit32.rshift(v1 * 4 + bit32.rshift(v2, 4), 0)
        local b = bit32.rshift(bit32.band(v2, 15) * 16 + bit32.rshift(v3, 2), 0)
        local c = bit32.rshift(bit32.band(v3, 3) * 64 + v4, 0)
        table.insert(r, string.char(a))
        if t[i+2] then table.insert(r, string.char(b)) end
        if t[i+3] then table.insert(r, string.char(c)) end
    end
    return table.concat(r)
end
`;

        const xorDecodeFn = `
local function xorDecode(str, keys)
    local result = {}
    local keyLen = #keys
    for i = 1, #str do
        local char = string.byte(str, i)
        local key = keys[((i-1) % keyLen) + 1]
        table.insert(result, string.char(bit32.bxor(char, key)))
    end
    return table.concat(result)
end
`;

        const antiTamperTemplate = `
local function checkTamper(src, expectedSum)
    local sum = 0
    for i = 1, #src do
        sum = sum + string.byte(src, i) * (i % 17 + 1)
    end
    if sum ~= expectedSum then
        error("Script tampered!")
    end
end
local code = [[%s]]
checkTamper(code, %d)
loadstring(code)()
`;

        const antiTamperNoSourceTemplate = `
local function checkTamper()
    local sum = 0
    local src = tostring(loadstring)
    for i = 1, #src do
        sum = sum + string.byte(src, i) * (i % 17 + 1)
    end
    if sum ~= %d then
        error("Script tampered!")
    end
end
checkTamper()
`;

        const protection247Fn = `
spawn(function()
    while true do
        wait(10)
    end
end)
`;

        const services = [
            "AdService", "AnalyticsService", "AssetService", "BadgeService", "ChangeHistoryService",
            "Chat", "CollectionService", "ContentProvider", "ContextActionService",
            "CoreGui", "Debris", "DebuggerManager", "DraftsService", "DraggerService",
            "FilteredSelection", "FriendService", "GamePassService", "GamepadService", "Geometry",
            "GroupService", "GuiService", "HSRDataContentProvider", "HapticService", "HttpRbxApiService",
            "HttpService", "InsertService", "Instance", "JointsService", "LanguageService",
            "Lighting", "LocalizationService", "LogService", "MarketplaceService", "MemStorageService",
            "MeshContentProvider", "NotificationService", "PermissionsService", "PhysicsService", "Players",
            "PluginDebugService", "PluginGuiService", "PointsService", "PolicyService", "ProcessInstancePhysicsService",
            "ReplicatedFirst", "ReplicatedStorage", "RunService", "ScriptContext", "Selection",
            "ServerScriptService", "ServerStorage", "SolidModelContentProvider", "SoundService", "StarterGui",
            "StarterPack", "StarterPlayer", "Stats", "StudioService", "Teams",
            "TeleportService", "TestService", "TextService", "TouchInputService", "TweenService",
            "VRService", "VirtualInputManager", "Visit", "Workspace"
        ];

        function removeComments(code) {
            return code
                .replace(/--\[\[[\s\S]*?\]\]/g, '')
                .replace(/--[^\n]*/g, '')
                .replace(/^\s+/gm, '')
                .replace(/\s+$/gm, '')
                .replace(/\n+/g, '\n');
        }

        function minifyCode(code) {
            return code
                .replace(/\s+/g, ' ')
                .replace(/ ?([=+-/*<>&|~^%]) ?/g, '$1')
                .replace(/ ?([(),;]) ?/g, '$1')
                .replace(/^\s+|\s+$/g, '');
        }

        function computeChecksum(code) {
            let sum = 0;
            for (let i = 0; i < code.length; i++) {
                sum += code.charCodeAt(i) * ((i % 17) + 1);
            }
            return sum;
        }

        function escapeLuauString(str) {
            let result = '';
            for (let i = 0; i < str.length; i++) {
                const charCode = str.charCodeAt(i);
                if (charCode < 32 || charCode > 126 || charCode === 34 || charCode === 92) {
                    result += `\\${charCode}`;
                } else {
                    result += str[i];
                }
            }
            return result;
        }

        function generateCustomBase64Table() {
            const std = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';
            const chars = std.split('');
            for (let i = chars.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [chars[i], chars[j]] = [chars[j], chars[i]];
            }
            return chars.join('');
        }

        function generateRandomKeys(len) {
            const keys = [];
            for (let i = 0; i < len; i++) {
                keys.push(Math.floor(Math.random() * 256));
            }
            return keys;
        }

        function obfuscate(type) {
            let code = document.getElementById('inputCode').value || defaultCode;
            let output = '';
            const antiTamper = document.getElementById('antiTamper').checked;
            const maxProtection = document.getElementById('maxProtection').checked;
            const protection247 = document.getElementById('24Protection').checked;
            const over5kb = document.getElementById('over5kb').checked;
            const numObf = document.getElementById('numObf').checked;
            const strSplit = document.getElementById('strSplit').checked;
            const hideSource = document.getElementById('hideSource').checked;
            const minify = document.getElementById('minify').checked;
            const deadCode = document.getElementById('deadCode').checked;

            let temp = removeComments(code);
            if (minify) {
                temp = minifyCode(temp);
            }

            let outputType = '';

            const protectedIdentifiers = new Set([
                'local', 'function', 'end', 'if', 'then', 'else', 'elseif', 'for', 'do', 'while',
                'repeat', 'until', 'break', 'return', 'in', 'not', 'and', 'or', 'true', 'false',
                'nil', 'game', 'workspace', 'script', 'shared', 'print', 'warn', 'error', 'assert',
                'collectgarbage', 'gcinfo', 'dofile', 'loadfile', 'loadstring', 'pcall', 'xpcall',
                'rawequal', 'rawget', 'rawset', 'select', 'setmetatable', 'getmetatable', 'tonumber',
                'tostring', 'type', 'unpack', '_G', '_VERSION', 'table', 'string', 'math', 'os',
                'bit32', 'coroutine', 'debug', 'Enum', 'Instance', 'UDim', 'UDim2', 'Vector2',
                'Vector3', 'CFrame', 'Color3', 'BrickColor', 'Ray', 'Region3', 'Region3int16',
                'Vector3int16', 'Vector2int16', 'task', 'wait', 'spawn', 'delay', 'Players',
                'LocalPlayer', 'Name', 'b64decode', 'xorDecode', 'checkTamper'
            ]);

            if (type === 'rename' || type === 'max') {
                let identifierMap = new Map();
                let variableCounter = 0;
                temp = temp.replace(/\b(local\s+|function\s+)(\w+)/g, (match, prefix, id) => {
                    if (protectedIdentifiers.has(id)) return match;
                    if (!identifierMap.has(id)) {
                        const prefixType = prefix.includes('function') ? '_fn' : '_var';
                        identifierMap.set(id, `${prefixType}${randomString(12 + variableCounter++ % 8)}`);
                    }
                    return `${prefix}${identifierMap.get(id)}`;
                });
                temp = temp.replace(/\b(\w+)\b/g, (match, id) => {
                    if (protectedIdentifiers.has(id) || !identifierMap.has(id)) return id;
                    return identifierMap.get(id);
                });
                outputType = type === 'rename' ? 'Variable Renaming' : outputType;
            }

            if (numObf || type === 'max') {
                temp = temp.replace(/\b(\d+)\b/g, (match, num) => {
                    num = parseInt(num);
                    if (num === 0) return '0';
                    if (num === 1) return '1';
                    const ops = [
                        () => `(${Math.floor(Math.random() * num + 1)} + ${num - Math.floor(Math.random() * num + 1)})`,
                        () => `(${num + Math.floor(Math.random() * 10)} - ${Math.floor(Math.random() * 10)})`,
                        () => `(${Math.floor(num / 2)} * ${num % 2 === 0 ? 2 : 1})`,
                        () => `(${num * Math.floor(Math.random() * 5 + 1)} / ${Math.floor(Math.random() * 5 + 1)})`,
                        () => `math.floor(math.sqrt(${num * num} + math.random()))`,
                        () => `bit32.bxor(${num ^ Math.floor(Math.random() * 100)}, ${Math.floor(Math.random() * 100)})`
                    ];
                    return ops[Math.floor(Math.random() * ops.length)]();
                });
            }

            if (strSplit || type === 'max') {
                temp = temp.replace(/"([^"]{3,})"/g, (match, str) => {
                    const parts = [];
                    let i = 0;
                    while (i < str.length) {
                        const len = Math.floor(Math.random() * 3) + 1;
                        parts.push(`"${escapeLuauString(str.substr(i, len))}"`);
                        if (Math.random() > 0.7) {
                            parts.push(`"${escapeLuauString(randomString(3))}"`);
                        }
                        i += len;
                    }
                    return parts.join(' .. ');
                });
            }

            if (type === 'base64' || type === 'max') {
                const customTable = generateCustomBase64Table();
                temp = temp.replace(/"([^"]*)"/g, (match, str) => {
                    const encoded = btoa(unescape(encodeURIComponent(str)));
                    const shuffled = encoded.replace(/./g, c => customTable[stdB64.indexOf(c)]);
                    const key = Math.floor(Math.random() * 256);
                    const encrypted = xorString(shuffled, key);
                    return `b64decode(xorDecode("${escapeLuauString(encrypted)}", [${key}]), "${customTable}")`;
                });
                outputType = type === 'base64' ? 'Base64 Strings' : outputType;
            }

            if (type === 'xor' || type === 'max') {
                const keys = generateRandomKeys(5 + Math.floor(Math.random() * 5));
                const keysStr = '[' + keys.join(', ') + ']';
                temp = temp.replace(/"([^"]*)"/g, (match, str) => {
                    let encrypted = '';
                    const keyLen = keys.length;
                    for (let i = 0; i < str.length; i++) {
                        encrypted += String.fromCharCode(str.charCodeAt(i) ^ keys[i % keyLen]);
                    }
                    const dummyKeys = generateRandomKeys(3);
                    return `xorDecode("${escapeLuauString(encrypted)}", ${keysStr})`;
                });
                outputType = type === 'xor' ? 'XOR Strings' : outputType;
            }

            if (type === 'control' || type === 'max') {
                const junkTemplates = [
                    `
local ${randomString(12)} = math.random(1, 100)
if ${randomString(12)} > ${Math.floor(Math.random() * 50 + 25)} then
    local ${randomString(12)} = math.sin(math.pi / ${Math.floor(Math.random() * 10 + 1)});
    local ${randomString(12)} = bit32.bxor(${Math.floor(Math.random() * 100)}, ${Math.floor(Math.random() * 100)});
    for ${randomString(12)} = 1, ${Math.floor(Math.random() * 3 + 1)} do
        local ${randomString(12)} = math.abs(math.random() - math.random());
    end
else
    local ${randomString(12)} = math.tan(math.random() * ${Math.random().toFixed(2)});
    local ${randomString(12)} = bit32.band(${Math.floor(Math.random() * 100)}, ${Math.floor(Math.random() * 100)});
    if math.random() > 0.5 then
        local ${randomString(12)} = math.ceil(math.random() * 100);
    end
end
`,
                    `
local ${randomString(12)} = math.random()
while ${randomString(12)} < ${Math.random().toFixed(2)} do
    local ${randomString(12)} = math.log10(math.random() * ${Math.floor(Math.random() * 10 + 1)})
    ${randomString(12)} = math.random()
end
`,
                    `
local ${randomString(12)} = {math.random(), math.random(), math.random()}
table.sort(${randomString(12)}, function(a, b) return a > b end)
`,
                    `
local ${randomString(12)} = function() return math.random() * ${Math.floor(Math.random() * 10 + 1)} end
for i = 1, ${Math.floor(Math.random() * 3 + 1)} do
    ${randomString(12)}()
end
`
                ];
                const lines = temp.split('\n');
                let newLines = [];
                for (let line of lines) {
                    newLines.push(line);
                    if (Math.random() > 0.3) {
                        const junkIndex = Math.floor(Math.random() * junkTemplates.length);
                        const repeatCount = Math.floor(Math.random() * 3) + 1;
                        newLines.push(junkTemplates[junkIndex].repeat(repeatCount));
                    }
                }
                temp = newLines.join('\n');
                outputType = type === 'control' ? 'Control Flow' : outputType;
            }

            if (deadCode || type === 'max') {
                const deadTemplates = [
                    `if false then print("${randomString(10)}") end`,
                    `local ${randomString(12)} = nil; if ${randomString(12)} then print("${randomString(5)}") end`,
                    `for i=1,0 do ${randomString(12)}() end`,
                    `local ${randomString(12)} = function() return math.random() end; if false then ${randomString(12)}() end`,
                    `if nil then local ${randomString(12)} = ${Math.random().toFixed(2)} end`,
                    `local ${randomString(12)} = math.random() > ${Math.random().toFixed(2)} and true or false; if ${randomString(12)} then end`
                ];
                const lines = temp.split('\n');
                let newLines = [];
                for (let line of lines) {
                    newLines.push(line);
                    if (Math.random() > 0.5) {
                        const deadIndex = Math.floor(Math.random() * deadTemplates.length);
                        newLines.push(deadTemplates[deadIndex]);
                    }
                }
                temp = newLines.join('\n');
            }

            if (type === 'max') {
                const extraKey = Math.floor(Math.random() * 256);
                const extraKeys = generateRandomKeys(5);
                const extraKeysStr = '[' + extraKeys.join(', ') + ']';
                temp = temp.replace(/b64decode\(xorDecode\("([^"]*)"\, \[(.*?)\]\), "([^"]*)"\)/g, (match, encrypted, keysStr, tbl) => {
                    let extraEncrypted = xorString(encrypted, extraKey);
                    const newKeys = extraKeys.map(k => k ^ extraKey);
                    const newKeysStr = '[' + newKeys.join(', ') + ']';
                    return `b64decode(xorDecode(xorDecode("${escapeLuauString(extraEncrypted)}", ${extraKeysStr}), ${newKeysStr}), "${tbl}")`;
                });
                outputType = 'Obfuscate Using Everything';
            }

            let finalCode = temp;

            let decodeFns = '';
            if (type === 'base64' || type === 'max') {
                decodeFns += base64DecodeFn;
            }
            if (type === 'xor' || type === 'max') {
                decodeFns += xorDecodeFn;
            }
            finalCode = decodeFns + finalCode;

            if (protection247) {
                finalCode = protection247Fn + finalCode;
            }

            if (over5kb) {
                let junk = '';
                const targetSize = 5120 * 2;
                while (junk.length < targetSize) {
                    for (let service of services) {
                        let varname = randomString(50); // Reduced length to avoid excessive memory use
                        junk += `local ${varname}=game:GetService("${service}")\n`;
                        if (junk.length >= targetSize) break;
                    }
                }
                finalCode = junk + finalCode + junk;
            }

            if (antiTamper) {
                if (hideSource || finalCode.length > 10000) {
                    const dummyCode = 'function() end';
                    const checksum = computeChecksum(dummyCode);
                    temp = antiTamperNoSourceTemplate.replace('%d', checksum) + finalCode;
                } else {
                    const checksum = computeChecksum(finalCode);
                    const escapedCode = finalCode.replace(/]]/g, ']] .. "]]"');
                    temp = antiTamperTemplate.replace('%s', escapedCode).replace('%d', checksum);
                }
            } else {
                temp = finalCode;
            }

            if (maxProtection) {
                temp = temp.replace(/b64decode\(xorDecode\("([^"]*)"\, \[(.*?)\]\), "([^"]*)"\)/g, (match, encrypted, keysStr, tbl) => {
                    const doubleTbl = generateCustomBase64Table();
                    const shuffledTbl = doubleTbl.replace(/./g, c => tbl[doubleTbl.indexOf(c)]);
                    const newKeys = generateRandomKeys(3);
                    const newKeysStr = '[' + newKeys.join(', ') + ']';
                    return `b64decode(xorDecode("${escapeLuauString(encrypted)}", ${newKeysStr}), "${shuffledTbl}")`;
                });
            }

            output = temp;

            output = removeComments(output);

            if (minify) {
                output = minifyCode(output);
            }

            document.getElementById('output-type').textContent = `Obfuscation Type: ${outputType}`;
            document.getElementById('output').textContent = output || 'Error: No output generated';
        }

        function copyCode() {
            const output = document.getElementById('output').textContent;
            if (output && output !== 'Obfuscated code will appear here...') {
                navigator.clipboard.writeText(output).then(() => {
                    alert('Code copied to clipboard!');
                }).catch(err => {
                    alert('Failed to copy: ' + err);
                });
            } else {
                alert('No code to copy!');
            }
        }

        function randomString(length) {
            const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_';
            let result = '_';
            for (let i = 0; i < length - 1; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        const stdB64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';

        function btoa(str) {
            try {
                return window.btoa(unescape(encodeURIComponent(str)));
            } catch (e) {
                console.error('Base64 encoding failed:', e);
                return str;
            }
        }

        function atob(str) {
            try {
                return decodeURIComponent(escape(window.atob(str)));
            } catch (e) {
                console.error('Base64 decoding failed:', e);
                return str;
            }
        }
    </script>
</body>
</html>
