<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ultimate Luau Deobfuscator</title>
<style>
body{background:#111;color:#eee;font-family:Consolas,monospace;margin:0;display:flex;align-items:center;justify-content:center;min-height:100vh}
.container{width:880px;max-width:95%;background:#1a1a1a;border-radius:12px;padding:20px;box-shadow:0 0 20px #0ff}
textarea{width:100%;height:200px;background:#222;color:#0f0;border:1px solid #0ff;border-radius:6px;padding:8px;resize:vertical}
button{background:linear-gradient(45deg,#0ff,#f0f);border:0;border-radius:6px;padding:8px 14px;color:#fff;cursor:pointer}
button:hover{opacity:.85}
.controls{display:flex;flex-wrap:wrap;gap:10px;margin:10px 0}
#output{white-space:pre-wrap;background:#000;color:#0f0;border:1px solid #f0f;border-radius:6px;padding:10px;max-height:420px;overflow:auto}
label{color:#ccc;font-size:.9em}
.status{margin:6px 0;font-size:.9em;color:#0ff}
</style>
</head>
<body>
<div class="container">
  <h2>âš¡ Ultimate Luau Deobfuscator</h2>
  <textarea id="inputCode" placeholder="Paste obfuscated Luau here..."></textarea>
  <div class="controls">
    <button onclick="runDeep()">Full Deep Clean</button>
    <button onclick="quick()">Quick Pass</button>
    <button onclick="stripJunk()">Strip Junk</button>
    <button onclick="copyOut()">Copy Output</button>
    <label><input type="checkbox" id="beautify" checked> Beautify</label>
    <label><input type="checkbox" id="xorBrute" checked> XOR brute</label>
  </div>
  <div id="status" class="status">Idle</div>
  <div id="output">Deobfuscated output appears here...</div>
</div>

<script>
/* ============ Utility Helpers ============ */
function logStatus(msg){document.getElementById('status').textContent=msg;}
function out(txt){const o=document.getElementById('output');o.textContent=txt;o.scrollTop=o.scrollHeight;}
function unq(s){return s.replace(/^['"]|['"]$/g,'');}
function looksB64(s){return /^[A-Za-z0-9+/=]+$/.test(s)&&s.length%4===0;}
function safeAtob(s){try{return atob(s);}catch(e){return null;}}
function hex2txt(h){try{return h.replace(/../g,c=>String.fromCharCode(parseInt(c,16)));}catch(e){return null;}}
function rot13(s){return s.replace(/[a-zA-Z]/g,c=>String.fromCharCode((c<="Z"?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26));}
function isAscii(s){return /^[\x09\x0A\x0D\x20-\x7E]*$/.test(s);}

/* ============ Core Passes ============ */
function decodeChars(c){return c.replace(/string\.char\(([\d,\s]+)\)/g,(m,nums)=>{try{return `"${nums.split(',').map(x=>String.fromCharCode(+x)).join('')}"`;}catch(e){return m;}});}
function concatLits(c){return c.replace(/(".*?")\s*\.\.\s*(".*?")/g,(m,a,b)=>`"${unq(a)+unq(b)}"`);}
function base64Lits(c){return c.replace(/(".*?")/g,(m)=>{const s=unq(m);if(looksB64(s)){const d=safeAtob(s);if(d&&isAscii(d))return `"${d}"`;}return m;});}
function hexLits(c){return c.replace(/(".*?")/g,(m)=>{const s=unq(m);if(/^[0-9a-fA-F]+$/.test(s)&&s.length>4){const d=hex2txt(s);if(d&&isAscii(d))return `"${d}"`;}return m;});}
function urlLits(c){return c.replace(/(".*?")/g,(m)=>{const s=unq(m);if(/%[0-9A-Fa-f]{2}/.test(s)){try{const d=decodeURIComponent(s);if(isAscii(d))return `"${d}"`;}catch(e){};}return m;});}
function rot13Lits(c){return c.replace(/(".*?")/g,(m)=>{const s=unq(m);if(/[A-Za-z]{6}/.test(s)){const d=rot13(s);if(isAscii(d)&&/local|function|game/.test(d))return `"${d}"`;}return m;});}
function xorBrute(c){return c.replace(/(".*?")/g,(m)=>{const s=unq(m);if(s.length<4) return m;for(let k=1;k<256;k++){let d="";for(let i=0;i<s.length;i++)d+=String.fromCharCode(s.charCodeAt(i)^k);if(isAscii(d)&&(/local|function|Players|game/.test(d)||looksB64(d))){return `"${d}"`;}}return m;});}
function stripJunkPass(c){return c
 .replace(/if\s+_[A-Za-z0-9]+\s*==\s*math\.random\([^)]+\)\s*then[\s\S]*?end/g,'')
 .replace(/local\s+_[A-Za-z0-9]+\s*=\s*[^;]+;?/g,'')
 .replace(/function\s+_[A-Za-z0-9]+\([^)]*\)\s*end/g,'-- removed junk function');}
function normalizeIds(c){let idx=1;return c.replace(/\b_[A-Za-z0-9]{8,}\b/g,()=>`v${idx++}`);}

/* Beautify */
function beautify(c){let ind=0,out=[];for(let l of c.split(/\n/)){l=l.trim();if(/^end|^else|^elseif|^until/.test(l))ind--;out.push("  ".repeat(Math.max(0,ind))+l);if(/\bthen$|\bdo$|\bfunction\b|\brepeat\b/.test(l))ind++;}return out.join("\n");}

/* ============ Orchestrator ============ */
async function runDeep(){
  let code=document.getElementById('inputCode').value;if(!code){alert('Paste code first');return;}
  let iter=0,changed=true;
  while(changed&&iter<20){
    changed=false;iter++;
    const before=code;
    code=decodeChars(code);
    code=concatLits(code);
    code=base64Lits(code);
    code=hexLits(code);
    code=urlLits(code);
    code=rot13Lits(code);
    if(document.getElementById('xorBrute').checked) code=xorBrute(code);
    code=stripJunkPass(code);
    code=normalizeIds(code);
    if(code!==before)changed=true;
    logStatus(`Pass ${iter} done, ${changed?"changes":"no changes"}`);
    await new Promise(r=>setTimeout(r,30));
  }
  if(document.getElementById('beautify').checked) code=beautify(code);
  out(code);
  logStatus(`Finished in ${iter} passes`);
}
function quick(){let c=document.getElementById('inputCode').value;c=decodeChars(concatLits(base64Lits(c)));out(c);logStatus("Quick pass done");}
function stripJunk(){let c=document.getElementById('inputCode').value;c=stripJunkPass(c);out(c);logStatus("Junk stripped");}
function copyOut(){navigator.clipboard.writeText(document.getElementById('output').textContent);}
</script>
</body>
</html>
