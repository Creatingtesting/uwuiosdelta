<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>LuaU Deobfuscater (Light)</title>
<style>
body{margin:0;font-family:Arial,monospace;background:#0b1224;color:#e0f0ff;display:flex;align-items:center;justify-content:center;height:100vh;padding:10px}
.container{width:100%;max-width:1000px;background:#0d1b3b;border-radius:12px;padding:20px;box-shadow:0 0 25px rgba(0,255,255,0.3)}
h1{margin:0;font-size:1.3rem;color:#00ffff;text-align:center;text-shadow:0 0 8px #0ff}
textarea{width:100%;height:250px;background:#071026;color:#cce;border:1px solid #00ffff;border-radius:8px;padding:10px;resize:vertical}
#output{width:100%;height:300px;background:#061020;color:#cff;border:1px solid #00ffcc;border-radius:8px;padding:10px;overflow:auto;white-space:pre-wrap}
.controls{margin:10px 0;display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:start}
button{padding:8px 12px;border:none;border-radius:6px;background:linear-gradient(45deg,#00ffff,#ff00ff);color:#001;font-weight:700;cursor:pointer;transition:0.2s}
button:hover{transform:scale(1.05);box-shadow:0 0 10px #00ffff}
label{font-size:.9rem;color:#cce}
.status{margin-top:6px;color:#9ff;font-size:.9rem}
</style>
</head>
<body>
<div class="container">
<h1>LuaU Deobfuscater (Light)</h1>
<label>Obfuscated Input:</label>
<textarea id="inputCode" placeholder="Paste your obfuscated LuaU code here..."></textarea>
<div class="controls">
<button id="deep">Deep Deobfuscate</button>
<button id="quick">Quick</button>
<button id="strip">Strip Junk</button>
<button id="copy">Copy Output</button>
<label><input type="checkbox" id="beautify" checked> Beautify</label>
<label><input type="checkbox" id="xor" checked> XOR brute</label>
<label><input type="checkbox" id="extract" checked> Extract loadstring</label>
</div>
<label>Deobfuscated Output:</label>
<div id="output">Output will appear here...</div>
<div class="status" id="status">Idle</div>
</div>
<script>
// UTILITY FUNCTIONS
function setStatus(t){document.getElementById('status').textContent=t}
function setOutput(t){const o=document.getElementById('output');o.textContent=t;o.scrollTop=o.scrollHeight}
function safeAtob(s){try{return decodeURIComponent(escape(window.atob(s)))}catch(e){try{return window.atob(s)}catch(e2){return null}}}
function isAscii(s){if(typeof s!=='string') return false;for(let i=0;i<s.length;i++){let c=s.charCodeAt(i);if(c===0||c>127)return false}return true}
function unquote(s){if(s.length>=2&&(s[0]==='"'||s[0]==="'")&&s[s.length-1]===s[0])return s.slice(1,-1).replace(/\\n/g,'\n').replace(/\\r/g,'\r').replace(/\\"/g,'"').replace(/\\'/g,"'");return s}
function qlua(s){return '"'+s.replace(/"/g,'\\"')+'"'}
function rot13(s){return s.replace(/[A-Za-z]/g,c=>{let b=c<='Z'?65:97;return String.fromCharCode((c.charCodeAt(0)-b+13)%26+b)})}
function hexToText(h){try{h=h.replace(/[^0-9a-fA-F]/g,'');if(h.length%2!==0)return null;let out='';for(let i=0;i<h.length;i+=2)out+=String.fromCharCode(parseInt(h.substr(i,2),16));return out}catch(e){return null}}
function urlDecode(s){try{return decodeURIComponent(s)}catch(e){return null}}

// DEOBFUSCATION LAYERS
function decodeStringChar(code){return code.replace(/string\.char\s*\(\s*([0-9,\s]+)\s*\)/gi,(m,nums)=>{try{const arr=nums.split(',').map(x=>parseInt(x.trim())).filter(n=>!isNaN(n)&&n>=0&&n<=255);if(arr.length===0)return m;const s=arr.map(n=>String.fromCharCode(n)).join('');if(!isAscii(s))return m;return qlua(s)}catch(e){return m}})}
function collapseConcats(code){let prev;do{prev=code;code=code.replace(/(['"])([\s\S]*?)\1\s*\.\.\s*(['"])([\s\S]*?)\3/g,(m,q1,a,q2,b)=>{try{const merged=unquote(q1+a+q1)+unquote(q2+b+q2);if(!isAscii(merged))return m;return qlua(merged)}catch(e){return m}})}while(code!==prev);return code}
function decodeB64Lits(code){return code.replace(/("([^"\\]|\\.)*"|'([^'\\]|\\.)*')/g, tok=>{const inner=unquote(tok);if(!inner||inner.length<2)return tok;const dec=safeAtob(inner);if(!dec||!isAscii(dec))return tok;return qlua(dec)})}
function decodeHexLits(code){return code.replace(/("([^"\\]|\\.)*"|'([^'\\]|\\.)*')/g, tok=>{const inner=unquote(tok);const dec=hexToText(inner);if(!dec||!isAscii(dec))return tok;return qlua(dec)})}
function decodeUrlLits(code){return code.replace(/("([^"\\]|\\.)*"|'([^'\\]|\\.)*')/g, tok=>{const inner=unquote(tok);const dec=urlDecode(inner);if(!dec||!isAscii(dec))return tok;return qlua(dec)})}
function decodeRot13Lits(code){return code.replace(/("([^"\\]|\\.)*"|'([^'\\]|\\.)*')/g,tok=>{const inner=unquote(tok);const dec=rot13(inner);return qlua(dec)})}
function bruteXorLits(code,maxKey){maxKey=maxKey||255;return code.replace(/("([^"\\]|\\.)*"|'([^'\\]|\\.)*')/g,tok=>{const inner=unquote(tok);for(let k=1;k<=maxKey;k++){let out='';for(let i=0;i<inner.length;i++)out+=String.fromCharCode(inner.charCodeAt(i)^k);if(/local|print|game|Players/.test(out))return qlua(out)}return tok})}
function unwrapWrappers(code){code=code.replace(/b64decode\s*\(\s*("([^"\\]|\\.)*"|'([^'\\]|\\.)*')\s*\)/g,(m,p1)=>{const inner=unquote(p1);const dec=safeAtob(inner);if(dec&&isAscii(dec))return qlua(dec);return m});return code}
function removeJunk(code){code=code.replace(/if\s+_[A-Za-z0-9]{3,}\s*==\s*math\.random[\s\S]*?end/g,'');code=code.replace(/function\s+_[A-Za-z0-9]{3,}\([^)]*\)\s*[\s\S]*?end/g,'');return code}
function extractLoad(code){code=code.replace(/loadstring\s*\(\s*("([^"\\]|\\.)*"|'([^'\\]|\\.)*')\s*\)/g,(m,p1)=>{const inner=unquote(p1);const dec=safeAtob(inner);if(dec&&isAscii(dec))return dec;return p1});return code}

// INTELLIGENT VARIABLE NAMING (simple semantic guesses)
function intelligentRename(code){
  const regex = /local\s+([A-Za-z_][A-Za-z0-9_]*)\s*=\s*(.+)/g
  let map = {}
  let m
  let counter=1
  while((m=regex.exec(code))!==null){
    let name = m[1], val = m[2].trim()
    if(val.startsWith('"')||val.startsWith("'")){
      let strVal = unquote(val)
      let newName = strVal.replace(/\W+/g,'')
      if(newName.length>0)newName=newName[0].toUpperCase()+newName.slice(1)
      else newName="String"+counter++
      map[name]=newName
    } else if(/^\d+$/.test(val)){
      map[name]="Count"+counter++
    } else if(/true|false/.test(val)){
      map[name]="Is"+counter++
    } else if(val.startsWith("function")){
      map[name]="Func"+counter++
    } else map[name]="Var"+counter++
  }
  for(let orig in map){
    const re=new RegExp('\\b'+orig+'\\b','g')
    code=code.replace(re,map[orig])
  }
  return code
}

// BEAUTIFY
function beautify(code){
  const lines=code.replace(/\r\n/g,'\n').split('\n')
  let indent=0,out=[]
  for(let line of lines){
    line=line.trim()
    if(line===''){out.push('');continue}
    if(/^(end|until|else|elseif)\b/.test(line))indent=Math.max(0,indent-1)
    out.push('  '.repeat(indent)+line)
    if(/\b(then|do|function|repeat)\b/.test(line))indent++
  }
  return out.join('\n')
}

// MAIN PROCESS
async function deobfuscate(full){
  let code=document.getElementById('inputCode').value||''
  if(!code){alert('Paste code first');return}
  const doBeaut=document.getElementById('beautify').checked
  const doXor=document.getElementById('xor').checked
  const doExtract=document.getElementById('extract').checked
  let iter=0,maxIter=15
  while(iter++<maxIter){
    let prev=code
    code=decodeStringChar(code)
    code=collapseConcats(code)
    code=unwrapWrappers(code)
    code=decodeB64Lits(code)
    code=decodeHexLits(code)
    code=decodeUrlLits(code)
    code=decodeRot13Lits(code)
    if(doXor) code=bruteXorLits(code)
    if(doExtract) code=extractLoad(code)
    code=removeJunk(code)
    code=intelligentRename(code)
    if(code===prev)break
    await new Promise(r=>setTimeout(r,1))
  }
  if(doBeaut) code=beautify(code)
  setOutput(code)
  setStatus('Finished ('+iter+' iterations)')
}

// BUTTON EVENTS
document.getElementById('deep').onclick=()=>deobfuscate(true)
document.getElementById('quick').onclick=()=>deobfuscate(false)
document.getElementById('strip').onclick=()=>{let c=document.getElementById('inputCode').value;setOutput(removeJunk(c));setStatus('Junk stripped')}
document.getElementById('copy').onclick=()=>{navigator.clipboard.writeText(document.getElementById('output').textContent).then(()=>alert('Copied!'))}
</script>
</body>
</html>
