<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Luau Deobfuscator</title>
  <style>
    body { font-family: monospace; background:#111; color:#0f0; padding:20px; }
    h1 { color:#6f6; }
    textarea {
      width:100%; height:200px; margin-top:10px;
      background:#222; color:#0f0; border:none; padding:10px;
    }
    button {
      margin-top:10px; padding:10px 20px;
      background:#333; color:#0f0; border:none; cursor:pointer;
    }
    button:hover { background:#444; }
  </style>
</head>
<body>
  <h1>Luau Deobfuscator</h1>
  <textarea id="input" placeholder="Paste obfuscated Luau code here..."></textarea>
  <br>
  <button onclick="deobfuscate()">Deobfuscate</button>
  <h2>Result:</h2>
  <textarea id="output" readonly></textarea>

  <script>
    // Decode \ddd ASCII escapes like \117
    function decodeAscii(str) {
      return str.replace(/\\(\d{1,3})/g, (_, num) =>
        String.fromCharCode(parseInt(num, 10))
      );
    }

    // Base64 decoder
    function decodeBase64(str) {
      try { return atob(str); } catch { return str; }
    }

    // Simple XOR decoder
    function xorDecode(str, key=123) {
      return str.split('')
        .map(c => String.fromCharCode(c.charCodeAt(0) ^ key))
        .join('');
    }

    function deobfuscate() {
      let code = document.getElementById("input").value;

      // Step 1: ASCII decode
      code = decodeAscii(code);

      // Step 2: Try base64 decode on long strings
      code = code.replace(/["']([A-Za-z0-9+/=]{12,})["']/g, (m, g) => {
        let decoded = decodeBase64(g);
        // If it looks like code, return decoded
        return (decoded.includes("function") || decoded.includes("local") || decoded.includes("{"))
          ? decoded
          : m;
      });

      // Step 3: Remove junk like :gsub(...)
      code = code.replace(/:gsub\(.+?\);?/g, "");

      // Step 4: Optional XOR (small keys trial)
      for (let k = 1; k < 5; k++) {
        let trial = xorDecode(code, k);
        if (/function|local|return/.test(trial)) {
          code = trial;
          break;
        }
      }

      // Show final source instead of running it
      document.getElementById("output").value = code;
    }
  </script>
</body>
</html>
